(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{4861:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return L}});var s=r(5893),n=r(7294),a=r(9008),o=function(e){var t=e.title,r=e.container,o=e.children;return(0,s.jsxs)(n.Fragment,{children:[(0,s.jsx)(a.default,{children:(0,s.jsx)("title",{children:t})}),r?(0,s.jsx)("div",{className:"container",children:o}):o]})};o.defaultProps={title:"CR-TEST",container:!0};var c=r(6265),u=r(618),i=r.n(u),m=r(809),p=r.n(m),l=r(2447),f=r(3106),d=r(9669),g=r.n(d),h=r(9249),_=r(6486),v=r.n(_),y=r(6940);r(4727);function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){(0,c.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var I=function(){var e=(0,y.I0)(),t=(0,n.useState)({err:{author:{},message:{}},author:"",message:""}),r=t[0],a=t[1];(0,n.useEffect)((function(){a(j(j({},r),{},{message:localStorage.getItem("message")?String(localStorage.getItem("message")):"",author:localStorage.getItem("author")?String(localStorage.getItem("author")):""}))}),[]);var o=function(e){var t=e.author,s=e.message,n={author:{},message:{}};return t?t.match(/^[\s\w]+$/)||(n.author.incorrectSym=!0):n.author.empty=!0,s||(n.message.empty=!0),s.match(/(?:(?:https?):\/\/)/)&&(n.message.httpMessage=!0),a(j(j({},r),{},{err:n})),v().isEmpty(n.author)&&v().isEmpty(n.message)},u=function(t){var r;t.author=t.author.trim(),t.message=t.message.trim(),o(t)&&(e((r=t,function(){var e=(0,l.Z)(p().mark((function e(t){var s,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:f.OU}),e.prev=1,e.next=4,g().post("/api/posts",r);case 4:return e.next=6,g().get("/api/posts");case 6:s=e.sent,n=s.data,t({type:f.Vy,payload:n}),h.Am.success("Message send"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),t({type:f.Ck,payload:e.t0.response&&e.t0.response.data.message?e.t0.response.data.message:e.t0.message}),h.Am.error(e.t0.response.data.message);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}())),a(j(j({},t),{},{message:""})),localStorage.setItem("message",""))},m=function(e){var t;a(j(j({},r),{},(t={},(0,c.Z)(t,e.target.name,e.target.value),(0,c.Z)(t,"err",j(j({},r.err),{},(0,c.Z)({},e.target.name,""))),t))),localStorage.setItem(e.target.name,e.target.value)},d=function(e){13===e.keyCode&&e.ctrlKey&&u(r)};return(0,s.jsxs)("div",{className:i().form,children:[(0,s.jsx)("span",{className:i().formHeader,children:"Guestbook form"}),(0,s.jsxs)("div",{className:i().formInputGroup,children:[(0,s.jsx)("span",{children:"Author:"}),(0,s.jsx)("input",{type:"text",name:"author",value:r.author,onChange:m,onKeyDown:d}),(0,s.jsxs)("div",{className:i().formErrorBlock,children:[r.err.author.empty&&"Field is empty",r.err.author.incorrectSym&&"Latin symbols, number and _ are allowed"]})]}),(0,s.jsxs)("div",{className:i().formInputGroup,children:[(0,s.jsx)("span",{children:"Message:"}),(0,s.jsx)("textarea",{rows:6,name:"message",value:r.message,onChange:m,onKeyDown:d}),(0,s.jsxs)("div",{className:i().formErrorBlock,children:[r.err.message.empty&&"Field is empty",r.err.message.httpMessage&&"URL Link is not allowed"]})]}),(0,s.jsx)("button",{className:i().btn,onClick:function(){return u(r)},children:"Send"}),(0,s.jsx)(h.Ix,{hideProgressBar:!0,closeOnClick:!0,draggable:!1,autoClose:3e3})]})},b=(0,n.memo)(I),O=r(1583),k=r.n(O),w=r(3998),G=r.n(w),N=function(e){var t=e.author,r=e.message;return console.log("rendered ".concat(t," ").concat(r)),(0,s.jsxs)("div",{className:G().listItem,children:[(0,s.jsxs)("span",{className:G().ListItemAuthor,children:["Author: ",t]}),(0,s.jsx)("p",{className:G().ListItemMessage,children:r})]})},E=(0,n.memo)(N),S=(0,y.$j)((function(e){return{posts:e.posts.posts}}))((function(e){var t=e.posts;return(0,s.jsxs)("div",{className:k().listGroup,children:[(0,s.jsx)("span",{className:k().listGroupHeader,children:"Latest posts"}),t.map((function(e){return(0,s.jsx)(E,{author:e.author,message:e.message},e._id)}))]})})),L=function(){var e=(0,y.I0)();return(0,n.useEffect)((function(){e(function(){var e=(0,l.Z)(p().mark((function e(t){var r,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:f.OU}),e.prev=1,e.next=4,g().get("/api/posts");case 4:r=e.sent,s=r.data,t({type:f.Vy,payload:s}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),t({type:f.Ck,payload:e.t0.response&&e.t0.response.data.message?e.t0.response.data.message:e.t0.message});case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}())}),[]),(0,s.jsxs)(o,{title:"Guest book",children:[(0,s.jsx)(b,{}),(0,s.jsx)(S,{})]})}},3106:function(e,t,r){"use strict";r.d(t,{OU:function(){return s},Vy:function(){return n},Ck:function(){return a}});var s="START_REQUEST",n="LOADING_DATA",a="POST_FAIL"},5301:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(4861)}])},618:function(e){e.exports={form:"FormGroup_form__12yOj",formHeader:"FormGroup_formHeader__zH2v4",formInputGroup:"FormGroup_formInputGroup__1BxTy",formErrorBlock:"FormGroup_formErrorBlock__-11vv",btn:"FormGroup_btn__3QVI8"}},1583:function(e){e.exports={listGroup:"ListGroup_listGroup__3mZ6c",listGroupHeader:"ListGroup_listGroupHeader__1psx3"}},3998:function(e){e.exports={listItem:"ListItem_listItem__1PP2s",listItemAuthor:"ListItem_listItemAuthor__1nT28",ListItemMessage:"ListItem_ListItemMessage__3xKvC"}}},function(e){e.O(0,[774,662,351,494,34],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);